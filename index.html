<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flappy Bird</title>

    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #70c5ce;
        }

        canvas {
            display: block;
        }
    </style>
</head>

<body>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

// ===== FULLSCREEN =====
function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
resizeCanvas();
window.addEventListener("resize", resizeCanvas);

// ===== LOAD ASSETS =====
const birdImg = new Image();
birdImg.src = "bird.png";

const pipeImg = new Image();
pipeImg.src = "pipe.png";

const flapSound = new Audio("flap.wav");
const hitSound = new Audio("hit.wav");
hitSound.volume = 1.0;

// ===== SETTINGS =====
const gravity = 0.5;
const lift = -8;
const pipeWidth = 90;
const pipeGap = 200;
const pipeSpeed = 3;

// ===== BIRD =====
let originalHeight = 50;

let bird = {
    x: 120,
    y: canvas.height / 2,
    width: 50,
    height: originalHeight,
    velocity: 0
};

let pipes = [];
let frame = 0;
let score = 0;
let gameOver = false;

// ===== CREATE PIPE =====
function createPipe() {
    let topHeight = Math.random() * (canvas.height / 2);
    pipes.push({
        x: canvas.width,
        top: topHeight,
        bottom: canvas.height - topHeight - pipeGap,
        counted: false
    });
}

// ===== DRAW BIRD =====
function drawBird() {
    ctx.drawImage(
        birdImg,
        bird.x - bird.width / 2,
        bird.y - bird.height / 2,
        bird.width,
        bird.height
    );
}

// ===== DRAW PIPES =====
function drawPipes() {
    pipes.forEach(pipe => {

        // Top pipe (flipped)
        ctx.save();
        ctx.translate(pipe.x + pipeWidth, pipe.top);
        ctx.scale(1, -1);
        ctx.drawImage(pipeImg, 0, 0, pipeWidth, pipe.top);
        ctx.restore();

        // Bottom pipe
        ctx.drawImage(
            pipeImg,
            pipe.x,
            canvas.height - pipe.bottom,
            pipeWidth,
            pipe.bottom
        );
    });
}

// ===== COLLISION =====
function checkCollision(pipe) {
    return (
        bird.x + bird.width / 2 > pipe.x &&
        bird.x - bird.width / 2 < pipe.x + pipeWidth &&
        (
            bird.y - bird.height / 2 < pipe.top ||
            bird.y + bird.height / 2 > canvas.height - pipe.bottom
        )
    );
}

// ===== UPDATE GAME =====
function update() {

    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Background text
    ctx.save();
    ctx.globalAlpha = 0.6;
    ctx.fillStyle = "black";
    ctx.textAlign = "center";
    ctx.font = "bold 60px Arial";
    ctx.fillText("Balu ❤️ Bhanu", canvas.width / 2, canvas.height / 2);
    ctx.restore();

    if (gameOver) {
        ctx.fillStyle = "red";
        ctx.font = "40px Arial";
        ctx.fillText("Game Over", canvas.width / 2 - 120, canvas.height / 2);
        ctx.font = "20px Arial";
        ctx.fillText("Click / Tap to Restart", canvas.width / 2 - 100, canvas.height / 2 + 40);
        return;
    }

    frame++;

    // Bird physics
    bird.velocity += gravity;
    bird.y += bird.velocity;

    // Smoothly restore height
    if (bird.height < originalHeight) {
        bird.height += 1.5;
    }

    if (frame % 90 === 0) createPipe();

    pipes.forEach(pipe => {
        pipe.x -= pipeSpeed;

        if (checkCollision(pipe)) {
            gameOver = true;
            hitSound.play();
        }

        if (!pipe.counted && pipe.x + pipeWidth < bird.x) {
            score++;
            pipe.counted = true;
        }
    });

    pipes = pipes.filter(pipe => pipe.x + pipeWidth > 0);

    // Top & bottom collision
    if (bird.y + bird.height / 2 > canvas.height ||
        bird.y - bird.height / 2 < 0) {
        gameOver = true;
        hitSound.play();
    }

    drawBird();
    drawPipes();

    ctx.fillStyle = "white";
    ctx.font = "30px Arial";
    ctx.fillText("Score: " + score, 20, 50);

    requestAnimationFrame(update);
}

// ===== JUMP =====
function jump() {
    if (gameOver) {
        location.reload();
        return;
    }

    bird.velocity = lift;

    // Reduce height instantly
    bird.height = 30;

    flapSound.currentTime = 0;
    flapSound.play();
}

document.addEventListener("click", jump);
document.addEventListener("touchstart", jump);
document.addEventListener("keydown", e => {
    if (e.code === "Space") jump();
});

// ===== START GAME =====
birdImg.onload = function () {
    update();
};

</script>

</body>
</html>
